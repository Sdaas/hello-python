#!/bin/bash

clearJupyterNotebooks() {
  # Clear outputs of all staged Jupyter notebooks
  echo "Clearing Jupyter notebook outputs..."
  for nb in $(git diff --cached --name-only | grep '\.ipynb$'); do
    if [ -f "$nb" ]; then
      jupyter nbconvert --to notebook --ClearOutputPreprocessor.enabled=True --ClearMetadataPreprocessor.enabled=True --inplace "$nb"
      git add "$nb"  # Re-add the cleaned notebook
      echo "Cleaned: $nb"
    fi
  done
}


# Main script execution
echo "Running pre-commit checks..." 
clearJupyterNotebooks
echo "Pre-commit checks completed."
echo "All changes are staged. You can now commit your changes."
echo "If you want to skip this pre-commit hook, use the --no-verify option with git commit."    